<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains the same -->
</head>
<body>
    <div class="header">
        <h1>Amazon Business Analytics Dashboard</h1>
        <!-- Add file input -->
        <div class="file-input-container">
            <input type="file" id="csvFile" accept=".csv">
            <button onclick="loadData()">Load Dashboard</button>
        </div>
    </div>

    <!-- Rest of your HTML remains the same -->

    <script>
        // Function to read and process the CSV file
        function loadData() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const csvData = event.target.result;
                    const parsedData = parseCSVData(csvData);
                    processData(parsedData);
                };
                
                reader.readAsText(file);
            } else {
                alert('Please select a CSV file');
            }
        }

        function parseCSVData(csvString) {
            // Split the CSV string into rows
            const rows = csvString.trim().split('\n');
            const headers = rows[0].split(',');
            
            return rows.slice(1).map(row => {
                const values = row.split(',');
                const rowData = {};
                headers.forEach((header, index) => {
                    rowData[header.trim()] = values[index];
                });
                return rowData;
            });
        }

        function processData(data) {
            console.log("Processing data:", data); // Debug log

            // Filter and organize data
            dashboardData = {
                gms: data.filter(row => row.section === 'B2B_GMS'),
                fba: data.filter(row => row.section === 'FBA'),
                fbaGVS: data.filter(row => row.section === 'FBA_GVS'),
                mfnGVS: data.filter(row => row.section === 'MFN_GVS'),
                selectionFBA: data.filter(row => row.section === 'SELECTION_FBA'),
                selectionMFN: data.filter(row => row.section === 'SELECTION_MFN')
            };

            // Create visualizations
            createCharts();
            updateMetrics();
        }

        function createCharts() {
            // GMS Chart
            const gmsData = dashboardData.gms;
            const gmsTrace = {
                x: gmsData.map(d => d.date),
                y: gmsData.map(d => parseFloat(d.value)),
                type: 'bar',
                name: 'GMS',
                marker: {
                    color: '#FF9900'
                }
            };

            const gmsLayout = {
                title: 'Weekly GMS by Channel',
                xaxis: { title: 'Date' },
                yaxis: { title: 'GMS Value' },
                barmode: 'stack'
            };

            Plotly.newPlot('gms-chart', [gmsTrace], gmsLayout);

            // AWAS Chart
            const awasData = dashboardData.selectionFBA;
            const awasTrace = {
                x: awasData.map(d => d.date),
                y: awasData.map(d => parseFloat(d.value)),
                type: 'line',
                name: 'AWAS'
            };

            const awasLayout = {
                title: 'Weekly AWAS Trend',
                xaxis: { title: 'Date' },
                yaxis: { title: 'AWAS Count' }
            };

            Plotly.newPlot('awas-chart', [awasTrace], awasLayout);

            // Add more charts as needed
        }

        function updateMetrics() {
            // Calculate totals
            const totalGMS = dashboardData.gms.reduce((sum, row) => 
                sum + parseFloat(row.value || 0), 0);
            
            const totalAWAS = dashboardData.selectionFBA.reduce((sum, row) => 
                sum + parseFloat(row.value || 0), 0);

            // Update metric cards
            document.getElementById('total-gms').textContent = 
                `â‚¬${totalGMS.toLocaleString(undefined, {maximumFractionDigits: 2})}`;
            document.getElementById('total-awas').textContent = 
                totalAWAS.toLocaleString(undefined, {maximumFractionDigits: 0});
        }

        // Filter handling
        function applyFilters() {
            const marketplace = document.getElementById('marketplace-filter').value;
            const sellerOrigin = document.getElementById('seller-origin-filter').value;
            const sellerType = document.getElementById('seller-type-filter').value;
            const productFamily = document.getElementById('pf-filter').value;

            let filteredData = dashboardData.gms;

            if (marketplace !== 'all') {
                filteredData = filteredData.filter(row => row.marketplace_id === marketplace);
            }
            if (sellerOrigin !== 'all') {
                filteredData = filteredData.filter(row => row.seller_origin === sellerOrigin);
            }
            if (sellerType !== 'all') {
                filteredData = filteredData.filter(row => row.bo_flag === sellerType);
            }
            if (productFamily !== 'all') {
                filteredData = filteredData.filter(row => row.pf === productFamily);
            }

            // Update visualizations with filtered data
            createCharts(filteredData);
            updateMetrics(filteredData);
        }

        // Add event listeners to filters
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', applyFilters);
        });
    </script>
</body>
</html>
